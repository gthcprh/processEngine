<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tct.data.dao.AssetsRelationMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.tct.data.model.AssetsRelation">
        <id column="id" property="id" />
        <result column="assets_id" property="assetsId" />
        <result column="assets_catalogue_tree_id" property="assetsCatalogueTreeId" />
        <result column="create_time" property="createTime" />
        <result column="update_time" property="updateTime" />
        <result column="enable" property="enable" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, assets_id, assets_catalogue_tree_id, create_time, update_time, enable
    </sql>
    <select id="selectAssetsIdsByDirectoryIds" resultType="java.lang.Integer">
        select assets_id from assets_relation
        <where>
            assets_catalogue_tree_id in
            <foreach collection="list" item="directoryId" index="index" open="(" close=")" separator=",">
                #{directoryId}
            </foreach>
        </where>
    </select>
    <select id="selectAssetsRelationsByDirectoryIds" resultType="com.tct.data.model.AssetsRelation">
        select * from assets_relation
        <where>
            assets_catalogue_tree_id in
            <foreach collection="list" item="directoryId" index="index" open="(" close=")" separator=",">
                #{directoryId}
            </foreach>
        </where>
    </select>
    <select id="selectAssetsIdsByDirectoryId" resultType="java.lang.Integer">
        select assets_id from assets_relation where assets_catalogue_tree_id = #{directoryId, jdbcType = INTEGER}
    </select>
    <select id="selectRelationIdsByDirectoryIds" resultType="java.lang.Integer">
        select id from assets_relation
        <where>
            assets_catalogue_tree_id in
            <foreach collection="list" item="directoryId" index="index" open="(" close=")" separator=",">
                #{directoryId}
            </foreach>
        </where>
    </select>

    <select id="selectRelationIdsByDirectoryId" resultType="java.lang.Integer">
        select id from assets_relation
        where assets_catalogue_tree_id = #{directoryId, jdbcType = INTEGER}
        and enable != 0
    </select>

    <select id="selectByRelateIds" resultType="com.tct.data.model.AssetsRelation">
        select * from assets_relation
        where assets_catalogue_tree_id = #{catalogueId, jdbcType = INTEGER}
        and  assets_id=#{assetsId, jdbcType = INTEGER}
        and  enable=#{enable, jdbcType = INTEGER}
    </select>

    <select id="getAssetsAssociateHistory" resultType="java.lang.Integer">
        select DISTINCT(t1.assets_catalogue_tree_id) targetId from assets_relation t1
        where t1.assets_id=#{assetsId, jdbcType = INTEGER}
        and t1.enable=0
    </select>

    <delete id="deleteByAssetsId" >
        delete from assets_relation where assets_id=#{assetsId, jdbcType = INTEGER}
    </delete>
    <select id="countAssetsRelationsStatus" resultType="java.lang.Integer">
        select count(1) from assets_relation
        <where>
            assets_catalogue_tree_id in
            <foreach collection="list" item="assetsId" index="index" open="(" close=")" separator=",">
                #{assetsId}
            </foreach>
        </where>
        and enable = 1
    </select>
    <select id="selectRelationIdsByAssetIds" resultType="java.lang.Integer">
        select id from assets_relation
        <where>
            assets_id in
            <foreach collection="list" item="assetsId" index="index" open="(" close=")" separator=",">
                #{assetsId}
            </foreach>
        </where>
    </select>
    <select id="selectRelationByAssetId" resultType="com.tct.data.model.AssetsRelation">
        select * from assets_relation where assets_id=#{assetsId, jdbcType = INTEGER} and enable=1
    </select>

    <select id="selectCatalogueByAssetsId" resultType="com.tct.data.model.AssetsCatalogueTree">
        select  t2.* from assets_relation t1
        left join assets_catalogue_tree t2 on t1.assets_catalogue_tree_id =t2.id
        where t1.enable=1 and t1.assets_id=#{assetsId}
    </select>
    <select id="selectIdsByDirectoryIds" resultType="java.lang.Integer">
        select id from assets_relation
        <where>
            assets_catalogue_tree_id in
            <foreach collection="list" item="directoryId" index="index" open="(" close=")" separator=",">
                #{directoryId}
            </foreach>
        </where>
    </select>
</mapper>
